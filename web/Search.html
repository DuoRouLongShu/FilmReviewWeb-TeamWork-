<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- ä¸Šè¿°3ä¸ªmetaæ ‡ç­¾*å¿…é¡»*æ”¾åœ¨æœ€å‰é¢ï¼Œä»»ä½•å…¶ä»–å†…å®¹éƒ½*å¿…é¡»*è·Ÿéšå…¶åï¼ -->
    <title>Search</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim å’Œ Respond.js æ˜¯ä¸ºäº†è®© IE8 æ”¯æŒ HTML5 å…ƒç´ å’Œåª’ä½“æŸ¥è¯¢ï¼ˆmedia queriesï¼‰åŠŸèƒ½ -->
    <!-- è­¦å‘Šï¼šé€šè¿‡ file:// åè®®ï¼ˆå°±æ˜¯ç›´æ¥å°† html é¡µé¢æ‹–æ‹½åˆ°æµè§ˆå™¨ä¸­ï¼‰è®¿é—®é¡µé¢æ—¶ Respond.js ä¸èµ·ä½œç”¨ -->
    <!--[if lt IE 9]>
    <!--<script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>-->
    <!--<script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>-->
    <!--[endif]-->

    <!-- jQuery (Bootstrap çš„æ‰€æœ‰ JavaScript æ’ä»¶éƒ½ä¾èµ– jQueryï¼Œæ‰€ä»¥å¿…é¡»æ”¾åœ¨å‰è¾¹) -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <!-- åŠ è½½ Bootstrap çš„æ‰€æœ‰ JavaScript æ’ä»¶ã€‚ä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åªåŠ è½½å•ä¸ªæ’ä»¶ã€‚ -->
    <script src="js/bootstrap.min.js"></script>
    <script>
        var films;
        var currentPage = 1;
        var totalCount;
        var totalPage;
        $(function () {
            $("#search").val(localStorage["word"]);
            localStorage.clear();
            // é¡¶éƒ¨æœç´¢æ¡†ï¼Œè¿›æ¥å°±å»åŠ è½½ä¿¡æ¯å»
            search();
        });
function special(obj) {
    if($(obj).prop("id") == "next"){
        currentPage = parseInt(currentPage) + 1;
    }else{
        currentPage -= 1;
    }
    if (currentPage <= 1) {
        currentPage = 1;
        $("#previous").parent().prop("class", "disabled");
    }else if(currentPage >= totalPage) {
        currentPage = totalPage;
        $("#next").parent().prop("class", "disabled");
    }
    filmeach(currentPage);
}
// ç½—åˆ—æ¯ä¸€é¡µç”µå½±çš„ä¿¡æ¯ã€‚
function filmeach(page) {
    // é¡µç çš„æ¿€æ´»æ•ˆæœ
    $("li[class='active']").prop("class","");
    var lis = $("#li li");
    lis.each(function (index, element) {
        // ä¾‹å­ï¼šç¬¬4é¡µå¯¹åº”ä¸‹æ ‡3çš„li
        if(index == page - 1){
            $(element).prop("class","active");
            // ç»“æŸå¾ªç¯
            return false;
        }
    });
    // æ›´æ–°é¡µç 
    currentPage = page;
    // å‰åé¡µçš„çŠ¶æ€
    if (currentPage <= 1) {
        currentPage = 1;
        $("#previous").parent().prop("class", "disabled");
    }else if(currentPage >= totalPage) {
        currentPage = totalPage;
        $("#next").parent().prop("class", "disabled");
    }else{
        $("#previous").parent().prop("class", "");
        $("#next").parent().prop("class", "");
    }
    // æ …æ ¼ç³»ç»Ÿï¼Œappendæ”¹å˜å†…å®¹
    $("#content").html("");
    $("#content").append("<div class='container'>" +
        "<div class=\"row\">\n" +
        "</div>");
    // æ·»åŠ ç”µå½±
    for (var i = (page-1)*8 ; i < films.data.length; i++) {
        $("div[class='row']").append(
            "        <div class=\"col-lg-3\">\n" +
            "            <a href=\"javascript:;\" onclick=select(this)>\n" +
            "                <img src=\"img/1590053103(1).jpg\"  class=\"img-thumbnail\"><br>\n" +
            "                <span>"+ films.data[i].filmName +"</span>\n" +
            "            </a>\n" +
            "            <p style=\"text-align: center\">" + films.data[i].rating + "</p>\n" +
            "        </div>\n"
        );
        // å¯¹åº”test4
        $("div[class='row'] img:nth-child(n)")[i].src = films.data[i].src;
    };
}
function search() {
    var word = $("#search").val();
    if(word != "") {
        $("#content").html("é¡µé¢åŠ è½½ä¸­.....ç­‰åˆ°ajaxå“åº”å›æ¥åæ›¿æ¢é¡µé¢");
        $.ajax({
            url: "./search/searchFilm",
            data: {"word": word},
            type: "post",
            success: function (data) {
                films = data;
                console.log(data.message);
                // å¢åŠ é¡µç 
                for (var i = 1; i <= totalPage; i++) {
                    $("#li").append("<li><a href='javascript:void(0)' onclick=fun(this.innerHTML); >"+i+"</a></li>");
                }
                // æ¿€æ´»ç¬¬ä¸€é¡µ
                $("#li li:first").prop("class","active");
                // æˆåŠŸåï¼Œå±•ç¤ºç¬¬ä¸€é¡µçš„ç”µå½±ä¿¡æ¯ï¼Œå®šæ­»æ¯é¡µ8ä¸ª
                filmeach(1);
            },
            dataType: "json"
        });
    }else{
        // é¡µé¢å†…å®¹ä»£æ›¿ä¸ºç©ºï¼Œè®©ç”¨æˆ·å»æœç´¢å»,"ç©ºç©ºå¦‚ä¹Ÿ"
        $("#content").html("ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«å»æœç´¢å§");
    }
}
        function select(obj) {
            //è·å–ç”µå½±å
            var filmName = $(obj).children().next().html();
            //è·³è½¬ç‰¹å®šé¡µé¢
            window.location.href = "http://localhost:8080/FilmReviewWeb/Movie.html?filmName="+filmName;
        }

    </script>
    <style>
        img{
            margin-left: 50px;
            margin-right: 60px;
        }
        div[class='row'] a span{
            margin-left: 100px;
            margin-right: 60px;
        }
    </style>
</head>
<body>
<!--æœç´¢æ¡†-->
<div class="container-fluid" style="margin-left: 350px;margin-top: 100px;">
    <a class="navbar-brand" href="#" >
        <blockquote style="border-color: #2aabd2;">
            <span style="font-weight: 700;font-size: 28px;color: #fff;text-shadow: 0 0 10px #1E9FFF">çŸ¥å½±</span>
        </blockquote>
    </a>
    <input id="search" type="text" class="form-control" placeholder="è¯·è¾“å…¥ä½ è¦æœç´¢çš„ç”µå½±åç§°æˆ–å–œæ¬¢çš„æ¼”å‘˜å’Œå¯¼æ¼”" style="width: 500px;height: 45px;margin-top: 10px;float: left">
    <input type="button" class="btn btn-primary btn-lg form-group" style="float: left;margin-top: 10px;margin-left: 5px" value="ğŸ”æœç´¢" onclick=search()>
</div><!-- /.container-fluid -->
<!--åˆ†å‰²çº¿-->
<br><hr style="border-color: #1E9FFF; width: 1000px;"><br>
<!--æœç´¢å†…å®¹-->
<div id="content"></div>
<!--åˆ†é¡µæ¡-->
<nav aria-label="Page navigation" style="text-align: center;margin-bottom: 80px">
    <ul class="pagination">
        <li>
            <a href="javascript:void(0)" aria-label="Previous" id="previous" onclick=special(this)>
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        <!--é¡µæ•°-->
        <ul class='pagination' id="li" style="margin-top:1px;"></ul>
        <li style="float: right;">
            <a href="javascript:void(0)" aria-label="Next" id="next" onclick=special(this) >
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>
</body>
</html>