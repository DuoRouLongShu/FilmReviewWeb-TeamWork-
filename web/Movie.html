<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Movie</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
    <!--<script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>-->
    <!--<script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>-->
    <!--[endif]-->

    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="js/jquery-3.2.1.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="js/bootstrap.min.js"></script>
</head>
<script>

    // // 请求获得相应的电影名称
    var MovieName = "倾国倾城";
    // 数据获取不到会堵塞？？？
    var totalPage;
    var totalCount;
    // 评论的对象、内容、点赞数
    var comments;
    function count(obj) {
        // 改变点赞数后要记得保存到数据
        var addLike = $(obj).html(parseInt($(obj).html())+1);
        // comments.data[].likes = addLike;
    }

    // 添加不同分页的评论内容
    function fun(obj) {
        // i 的位置需要注意，可能错在这
        var i = (obj.innerText - 1) * 5;
        console.log(obj.innerText);
        if (i < 0 || i == null) {
            i = 0;
        }
        $("#name1").html(comments.data[i].userName);
        $("#comment1").html(comments.data[i].text+"<br>"+comments.data[i].title);
        $("#like1").html(comments.data[i].likes);
        $("#time1").html(comments.data[i].creatDate);
        $("#rate1").html(comments.data[i].rating);
        i++;
        if(i < comments.data.length) {
            $("#name2").html(comments.data[i].userName);
            $("#comment2").html(comments.data[i].text+"<br>"+comments.data[i].title);
            $("#like2").html(comments.data[i].likes);
            $("#time2").html(comments.data[i].creatDate);
            $("#rate2").html(comments.data[i].rating);
        }
        i++;
        if(i < comments.data.length) {
            $("#name3").html(comments.data[i].userName);
            $("#comment3").html(comments.data[i].text+"<br>"+comments.data[i].title);
            $("#like3").html(comments.data[i].likes);
            $("#time3").html(comments.data[i].creatDate);
            $("#rate3").html(comments.data[i].rating);
        }
        i++;
        if(i < comments.data.length) {
            $("#name4").html(comments.data[i].userName);
            $("#comment4").html(comments.data[i].text+"<br>"+comments.data[i].title);
            $("#like4").html(comments.data[i].likes);
            $("#time4").html(comments.data[i].creatDate);
            $("#rate4").html(comments.data[i].rating);
        }
        i++;
        if(i < comments.data.length) {
            $("#name5").html(comments.data[i].userName);
            $("#comment5").html(comments.data[i].text+"<br>"+comments.data[i].title);
            $("#like5").html(comments.data[i].likes);
            $("#time5").html(comments.data[i].creatDate);
            $("#rate5").html(comments.data[i].rating);
        }
    }

    $(function (){
        // 评论区（json）
        $.ajax({
            // 去Servlet里查询所有该电影的影评，以及总页数，返回一个json对象，包含总记录数等
            url:"http://localhost:8080/FilmReviewWeb/filmpage/getReviews",
            data:{"filmName":MovieName},
            type:"post",
            success:function(data){
                comments = data;
                totalPage = data.pageCount;
                totalCount = data.dataCount;
                $("#totalCount").html(totalCount);
                // 分页
                for (var i = 1; i <= totalPage; i++) {
                    // 分页的按钮
                    $("#li").append("<li><a href='javascript:void(0)' onclick=fun(this); >"+i+"</a></li>");
                }

                // 刚开始的显示内容
                $("#name1").html(comments.data[0].userName);
                $("#comment1").html(comments.data[0].text+"<br>"+comments.data[4].title);
                $("#like1").html(comments.data[0].likes);
                $("#time1").html(comments.data[0].creatDate);
                $("#rate1").html(comments.data[0].rating);

                $("#name2").html(comments.data[1].userName);
                $("#comment2").html(comments.data[1].text+"<br>"+comments.data[4].title);
                $("#like2").html(comments.data[1].likes);
                $("#time2").html(comments.data[1].creatDate);
                $("#rate2").html(comments.data[1].rating);

                $("#name3").html(comments.data[2].userName);
                $("#comment3").html(comments.data[2].text+"<br>"+comments.data[4].title);
                $("#like3").html(comments.data[2].likes);
                $("#time3").html(comments.data[2].creatDate);
                $("#rate3").html(comments.data[2].rating);

                $("#name4").html(comments.data[3].userName);
                $("#comment4").html(comments.data[3].text+"<br>"+comments.data[4].title);
                $("#like4").html(comments.data[3].likes);
                $("#time4").html(comments.data[3].creatDate);
                $("#rate4").html(comments.data[3].rating);

                $("#name5").html(comments.data[4].userName);
                $("#comment5").html(comments.data[4].text+"<br>"+comments.data[4].title);
                $("#like5").html(comments.data[4].likes);
                $("#time5").html(comments.data[4].creatDate);
                $("#rate5").html(comments.data[4].rating);
            },
            dataType:"json"
        });

        $.ajax({
            url:"http://localhost:8080/FilmReviewWeb/filmpage/getData",
            data:{"filmName":MovieName},
            type:"post",
            success:function (data) {
                // 为页面添加真实内容
                $(".time").html(data.data.releaseDate);
                $(".filmName").html(data.data.filmName);
                $("#rating").html(data.data.rating);
                $("#area").html(data.data.area);
                $("#director").html(data.data.director);
                $("#writer").html(data.data.writer);
                $("#performer").html(data.data.performer);
                $("#genre").html(data.data.genre);
                $("#language").html(data.data.language);
                $("#duration").html(data.data.duration);
                $("#synopsis").html(data.data.synopsis);
            },
            dataType:"json"
        });

        $(".write").click(function () {
            // 需要换路径啊！！！！！！
            // window.location.href = "http://localhost:8080/FilmReviewWeb/WriteComment.html?filmName"+data.data.filmName;
            window.location.href = "http://localhost:8080/FilmReviewWeb/WriteComment.html";
        });
        // $("#collect").click(function () {
        //     alert("collect")
        // });


    });

</script>
        <style>
            #search{
                margin-left: 300px;
                width: 500px;
            }
            .name{
                font-weight: 900;
                font-size: 30px;
            }
            .time{
                font-size: 30px;
                color: #9d9d9d;
            }
            .information{
                font-size: 20px;
            }
            .t{
                 margin-top: 10px;
                 margin-left: 30px;
             }
            .color{
                color: green;
            }
            .p{
                font-size:large;
                font-weight: bold;
            }
            textarea{
                resize: none;
            }
        </style>

<body>
    <!--导航条-->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">首页</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <form class="navbar-form navbar-left">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="请输入你要搜索的电影名称" id="search">
                    </div>
                    <button type="submit" class="btn btn-default">搜索</button>
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#">个人中心</a></li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
    <span class="name t filmName" style="margin-left: 40px">电影名称 </span>(  <span class="time">时间</span>)<br>
    <div class="row t">
        <div class="col-md-4"><img src="img/45d30c6591fc702987439347f480a426.jpg" alt="电影海报" height="50%" width="100%" ></div>
        <div class="col-md-8 information">
            导演:    <span id="director">名字</span><br>
            编剧:    <span id="writer">名字</span><br>
            主演:    <span id="performer">  名字</span><br>
            类型:    <span id="genre">名字</span><br>
            制片地区:    <span id="area">名字</span><br>
            评分:    <span id="rating">分数</span><br>
            语言:    <span id="language">语言</span><br>
            片长:    <span id="duration">片长</span><br>
            梗概:    <span id="synopsis">梗概</span><br>
        </div>
    </div>
    <input type="button" class="btn btn-default t write" value="写影评" style="margin-left: 40px">
    <input type="button" class="btn btn-default t" value="收藏" id="collect">
    <input type="button" class="btn btn-default t" value="分享到" >
    <br><br><br>
        <h3 class="t">网友影评</h3>
        <div class="t color" style="float: left;font-size: medium"><span class="filmName">电影名字</span>影评</div>
        <input type="button" class="btn btn-default write" value="我要写影评" style="float: right;margin-right: 60px">
    <br><br>

     <!--评论区-->
    <div class="t">
        <div style="float: left;"><span id="name1">用户名字</span> 看过</div>
        <div style="color: #9d9d9d">&nbsp;&nbsp;&nbsp;(<span id="time1">评论时间</span>)&nbsp;&nbsp;&nbsp;<span style="color: gold;font-size: large;font-weight: 700">评分:  <span id="rate1">5.0</span></span></div>
        <span style="float: right;margin-right: 60px;color: #2aabd2">点赞</span><a href="javascript:void(0)" onclick=count(this); style="float: right" id="like1">0</a>
        <textarea cols="132" rows="5" id="comment1" class="p" readonly>评论导入</textarea><br><br>

        <div style="float: left;"><span id="name2">用户名字</span> 看过</div>
        <div style="color: #9d9d9d">&nbsp;&nbsp;&nbsp;(<span id="time2">评论时间</span>)&nbsp;&nbsp;&nbsp;<span style="color: gold;font-size: large;font-weight: 700">评分:  <span id="rate2">5.0</span></span></div>
        <span style="float: right;margin-right: 60px;color: #2aabd2">点赞</span><a href="javascript:void(0)" onclick=count(this); style="float: right" id="like2">0</a>
        <textarea cols="132" rows="5" id="comment2" class="p" readonly>评论导入</textarea><br><br>

        <div style="float: left;"><span id="name3">用户名字</span> 看过</div>
        <div style="color: #9d9d9d">&nbsp;&nbsp;&nbsp;(<span id="time3">评论时间</span>)&nbsp;&nbsp;&nbsp;<span style="color: gold;font-size: large;font-weight: 700">评分:  <span id="rate3">5.0</span></span></div>
        <span style="float: right;margin-right: 60px;color: #2aabd2">点赞</span><a href="javascript:void(0)" onclick=count(this); style="float: right" id="like3">0</a>
        <textarea cols="132" rows="5" id="comment3" class="p" readonly>评论导入</textarea><br><br>


        <div style="float: left;"><span id="name4">用户名字</span> 看过</div>
        <div style="color: #9d9d9d">&nbsp;&nbsp;&nbsp;(<span id="time4">评论时间</span>)&nbsp;&nbsp;&nbsp;<span style="color: gold;font-size: large;font-weight: 700">评分:  <span id="rate4">5.0</span></span></div>
        <span style="float: right;margin-right: 60px;color: #2aabd2">点赞</span><a href="javascript:void(0)" onclick=count(this); style="float: right" id="like4">0</a>
        <textarea cols="132" rows="5" id="comment4" class="p" readonly>评论导入</textarea><br><br>


        <div style="float: left;"><span id="name5">用户名字</span> 看过</div>
        <div style="color: #9d9d9d">&nbsp;&nbsp;&nbsp;(<span id="time5">评论时间</span>)&nbsp;&nbsp;&nbsp;<span style="color: gold;font-size: large;font-weight: 700">评分:  <span id="rate5">5.0</span></span></div>
        <span style="float: right;margin-right: 60px;color: #2aabd2">点赞</span><a href="javascript:void(0)" onclick=count(this); style="float: right" id="like5">0</a>
        <textarea cols="132" rows="5" id="comment5" class="p" readonly>评论导入</textarea><br><br>


    </div>


    <!--分页条-->
    <nav aria-label="Page navigation" style="text-align: center;">
        <ul class="pagination">
            <li >
                <a href="javascript:void(0)" aria-label="Previous" onclick=fun()>
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <!--页数-->
            <ul class='pagination' id="li" style="margin-top:1px;"></ul>
            <li style="float: right">
                <a href="javascript:void(0)" aria-label="Next" onclick=fun()>
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul><div style="vertical-align: middle;font-size: large;color: #2aabd2">共<span id="totalCount"></span>条记录</div>
    </nav>

</body>
</html>